<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="himedia.slivermate.mappers.SliverPostMapper">
	<resultMap id="PostResultMap" type="sliverPost">
	    <id column="post_id" property="post_id" />
	    <result column="region_id" property="region_id" />
	    <result column="post_user_id" property="post_user_id" />
	    <result column="club_id" property="club_id" />
	    <result column="post_category_id" property="post_category_id" />
	    <result column="post_sub_category_id" property="post_sub_category_id" />
	    <result column="post_note" property="post_note" />
	    
	    <!-- JSON 컬럼 -->
	    <result column="post_images" property="post_images" 
	            typeHandler="himedia.slivermate.typehandler.JsonFlexibleTypeHandler"/>
	
	    <result column="post_like_count" property="post_like_count" />
	    <result column="post_comment_count" property="post_comment_count" />
	    
   	    <!-- JSON 컬럼 -->
	    <result column="post_comments" property="post_comments" 
	            typeHandler="himedia.slivermate.typehandler.JsonFlexibleTypeHandler"/>
	            
	    <result column="is_hidden" property="is_hidden" />
	    <result column="post_report_count" property="post_report_count" />
	    <result column="register_date" property="register_date" />
	    <result column="upd_date" property="upd_date" />
	
	    <!-- 유저 정보 -->
	    <result column="nickname" property="nickname" />
	    <result column="user_thumbnail" property="user_thumbnail" />
	</resultMap>

	<select id="selectAllPosts" resultMap="himedia.slivermate.mappers.SliverPostMapper.PostResultMap">
	SELECT post.*, user.nickname AS nickname, user.thumbnail AS user_thumbnail 
	FROM sliver_post AS post 
	JOIN sliver_user AS user 
	WHERE post.post_user_id=user.uid ORDER BY post_id DESC
	</select>
	
	<select id="selectPostById" resultMap="himedia.slivermate.mappers.SliverPostMapper.PostResultMap">
	SELECT post.*, user.nickname AS nickname, user.thumbnail AS user_thumbnail 
	FROM sliver_post AS post 
	JOIN sliver_user AS user 
	WHERE post.post_user_id=user.uid AND post.post_id=#{post_id}
	</select>
	
	
	<insert id="insertNewPost" parameterType="sliverPost">
	INSERT INTO sliver_post (post_user_id, club_id, region_id,
	post_category_id, post_sub_category_id, post_note, post_images,
	post_like_count, post_comment_count, post_comments, is_hidden, post_report_count,
	register_date, upd_date, user_thumbnail, nickname)
	VALUES (#{post_user_id}, #{club_id}, #{region_id},
	#{post_category_id}, #{post_sub_category_id}, 
	#{post_note}, #{post_images, typeHandler=himedia.slivermate.typehandler.JsonFlexibleTypeHandler},
	#{post_like_count}, #{post_comment_count}, 
	#{post_comments, typeHandler=himedia.slivermate.typehandler.JsonFlexibleTypeHandler}, 
	#{is_hidden}, #{post_report_count}, #{register_date}, 
	#{upd_date}, #{user_thumbnail}, #{nickname})
	</insert>
</mapper>