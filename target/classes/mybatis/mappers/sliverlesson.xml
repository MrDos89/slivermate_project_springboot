<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="himedia.slivermate.mappers.SliverLessonMapper">
	<select id="selectAllLessons" 
		resultType="sliverLesson">
	SELECT lesson.*, user.nickname, user.thumbnail FROM sliver_lesson AS lesson JOIN sliver_user AS user WHERE lesson.uid=user.uid ORDER BY lesson_id DESC
	</select>
	
	<select id="selectLessonsByCategoryId"
		parameterType="Int"
		resultType="sliverLesson">
	SELECT lesson.*, user.nickname, user.thumbnail FROM sliver_lesson AS lesson JOIN sliver_user AS user WHERE category_id=#{category_id} AND lesson.user_id=user.uid
	</select>
	
	<select id="selectLessonsByUserId"
		parameterType="Long"
		resultType="sliverLesson">
	SELECT lesson.*, user.nickname, user.thumbnail FROM sliver_lesson AS lesson JOIN sliver_user AS user WHERE user_id=#{user_id} AND lesson.user_id=user.uid
	</select>
	
	<select id="selecLessonById"
		parameterType="Long"
		resultType="sliverLesson">
	SELECT post.*, user.nickname, user.thumbnail, user.user_rate FROM goguma_post AS post JOIN goguma_user AS user WHERE pid=#{pid} AND post.uid=user.uid
	</select>
	
	<select id="selectMyPosts"
		parameterType="Long"
		resultType="sliverLesson">
	SELECT pid, post_title, post_photo, report_cnt, upd_date FROM goguma_post WHERE uid=#{uid}
	</select>
	
	<select id="selectRelatedPosts"
		resultType="sliverLesson">
	SELECT post.*, user.nickname, user.thumbnail, user.user_rate
	FROM goguma_post AS post
	LEFT JOIN goguma_user AS user ON post.uid = user.uid
	WHERE post.post_category = #{post_category}
  	AND post.loca_gu = #{loca_gu}
  	AND post.loca_dong = #{loca_dong} ORDER BY user_rate DESC LIMIT 5
	</select>
	
	<insert id="insertPost" parameterType="sliverLesson">
	INSERT INTO goguma_post (uid, selected_uid, loca_gu, loca_dong, post_title, post_photo, post_content, post_category, post_price, user_list, report_cnt)
	VALUES (#{uid}, #{selected_uid}, #{loca_gu}, #{loca_dong}, #{post_title}, #{post_photo}, #{post_content}, #{post_category}, #{post_price}, #{user_list}, #{report_cnt})
	</insert>
	
	<update id="updatePost" parameterType="sliverLesson">
	UPDATE goguma_post SET
	uid=#{uid}, selected_uid=#{selected_uid}, loca_gu=#{loca_gu}, loca_dong=#{loca_dong}, post_title=#{post_title}, 
	post_photo=#{post_photo}, post_content=#{post_content}, post_category=#{post_category}, post_price=#{post_price}, user_list=#{user_list}, report_cnt=#{report_cnt}
	WHERE pid=#{pid}
	</update>

	<update id="updatePostUserList" parameterType="sliverLesson">
	UPDATE goguma_post SET
	user_list=#{user_list}
	WHERE pid=#{pid}
	</update>
	
	<update id="updatePostReportCnt" parameterType="sliverLesson">
	UPDATE goguma_post SET
	report_cnt=report_cnt+#{report_cnt}
	WHERE pid=#{pid}
	</update>

	<delete id="deletePost" parameterType="Long">
	DELETE FROM goguma_post WHERE pid=#{pid}
	</delete>
</mapper>