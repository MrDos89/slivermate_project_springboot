<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="himedia.slivermate.mappers.SliverLessonMapper">
	<select id="selectAllLessons" 
		resultType="sliverLesson">
	SELECT lesson.*, user.nickname, user.thumbnail FROM sliver_lesson AS lesson JOIN sliver_user AS user WHERE lesson.uid=user.uid ORDER BY lesson_id DESC
	</select>
	
	<select id="selectLessonsByCategoryId"
		parameterType="Int"
		resultType="sliverLesson">
	SELECT lesson.*, user.nickname, user.thumbnail FROM sliver_lesson AS lesson JOIN sliver_user AS user WHERE lesson_category=#{category_id} AND lesson.user_id=user.uid
	</select>

	<select id="selectLessonsBySubCategoryId"
		parameterType="Int"
		resultType="sliverLesson">
	SELECT lesson.*, user.nickname, user.thumbnail FROM sliver_lesson AS lesson JOIN sliver_user AS user WHERE lesson_sub_category=#{category_id} AND lesson.user_id=user.uid
	</select>
	
	<select id="selectLessonsByUserId"
		parameterType="Long"
		resultType="sliverLesson">
	SELECT lesson.*, user.nickname, user.thumbnail FROM sliver_lesson AS lesson JOIN sliver_user AS user WHERE user_id=#{user_id} AND lesson.user_id=user.uid
	</select>
	
	<select id="selectRelatedLessons"
		resultType="sliverLesson">
	SELECT lesson.*, user.nickname, user.thumbnail, user.user_rate
	FROM sliver_lesson AS lesson
	LEFT JOIN sliver_user AS user ON lesson.uid = user.uid
	WHERE lesson.lesson_category = #{lesson_category}
  	AND lesson.lesson_sub_category = #{lesson_sub_category}
  	ORDER BY lesson.lesson_register_date DESC LIMIT 5
	</select>
	
	<select id="selecLessonById"
		parameterType="Long"
		resultType="sliverLesson">
	SELECT lesson.*, user.nickname, user.thumbnail FROM sliver_lesson AS lesson JOIN sliver_user AS user WHERE lesson_id=#{id} AND lesson.uid=user.uid
	</select>
	
	<insert id="insertLesson" parameterType="sliverLesson">
	INSERT INTO sliver_lesson (user_id, lesson_name, lesson_desc, lesson_category, lesson_sub_category, lesson_free_lecture, lesson_cost_lecture, lesson_thumbnail, lesson_price, lesson_register_date, is_hidden)
	VALUES (#{user_id}, #{lesson_name}, #{lesson_desc}, #{lesson_category}, #{lesson_sub_category}, #{lesson_free_lecture}, #{lesson_cost_lecture}, #{lesson_thumbnail}, #{lesson_price}, #{lesson_register_date}, #{is_hidden})
	</insert>
	
	<update id="updateLesson" parameterType="sliverLesson">
	UPDATE sliver_lesson SET
	user_id=#{user_id}, lesson_name=#{lesson_name}, lesson_desc=#{lesson_desc}, lesson_category=#{lesson_category}, lesson_sub_category=#{lesson_sub_category}, 
	lesson_free_lecture=#{lesson_free_lecture}, lesson_cost_lecture=#{lesson_cost_lecture}, lesson_thumbnail=#{lesson_thumbnail}, lesson_price=#{lesson_price}, lesson_register_date=#{lesson_register_date}, is_hidden=#{is_hidden}
	WHERE lesson_id=#{lesson_id}
	</update>

	<update id="hideLesson" parameterType="sliverLesson">
	UPDATE sliver_lesson SET
	is_hidden=!is_hidden
	WHERE lesson_id=#{id}
	</update>
	
	<!-- 
	<update id="updatePostReportCnt" parameterType="sliverLesson">
	UPDATE goguma_post SET
	report_cnt=report_cnt+#{report_cnt}
	WHERE pid=#{pid}
	</update> -->

	<delete id="deletePost" parameterType="Long">
	DELETE FROM sliver_lesson WHERE lesson_id=#{id}
	</delete>
</mapper>